<div class="classification-history-modal-content col-md-9">
<span id="classification-history-last-step" data-last-step="<%= @classification_history.length %>"></span>

<% player_name = lambda do |player_id|
     player = player_id && @players[player_id]
     player&.name || '—'
   end %>
<% @classification_history.each_with_index do |entry, index| %>
<% match = entry[:match] %>
<% quick = if match.respond_to?(:quick_match?)
            match.quick_match?
          elsif match.respond_to?(:quick_match)
            match.quick_match
          else
            false
          end %>
<% highlight_map = entry[:highlight] || {} %>
<% player_slots = match.players.each_with_index.map { |pid, idx| { id: pid, index: idx } }.reject { |slot| slot[:id].nil? } %>
<% victories = Array(match.victories) %>
<div class="classification-history col-md-12" id="classification-history-<%= index + 1 %>" data-match-id="<%= match.id %>" data-step="<%= index + 1 %>" data-quick-match="<%= quick ? 'true' : 'false' %>" style="display: none">

<div class="col-md-4">
<p class="text-center"><%= index + 1 %>/<%= @classification_history.length %></p>
<% if quick %>
<p class="text-center text-warning quick-match-indicator"><span class="glyphicon glyphicon-flash" aria-hidden="true"></span><span class="sr-only">Quick Match</span></p>
<% end %>
<ul class="pager">
  <li><a href="#" class="history-first"><span class="glyphicon glyphicon-fast-backward"></span></a></li>
  <li><a href="#" class="history-previous"><span class="glyphicon glyphicon-backward"></span></a></li>
  <li><a href="#" class="history-next"><span class="glyphicon glyphicon-forward"></span></a></li>
  <li><a href="#" class="history-last"><span class="glyphicon glyphicon-fast-forward"></span></a></li>
</ul>
<table class="table table-borderless table-condensed">
<tr>
<th class="text-center col-md-6">Player</th>
<th class="text-center col-md-6"># Wins</th>
</tr>
<% player_slots.each do |slot| %>
<% highlight_class = highlight_map.key?(slot[:id]) ? 'active' : '' %>
<tr class="<%= highlight_class %>">
<td class="text-center"><%= player_name.call(slot[:id]) %></td>
<td class="text-center"><%= victories[slot[:index]] || '—' %></td>
</tr>
<% end %>
</table>
</div>

<div class="col-md-4">
<table class="table table-super-condensed table-borderless">
<% entry[:before].each do |c| %>
<% if highlight_map.key?(c[:player_id]) %>
<tr class="active">
<% else %>
<tr>
<% end %>
<td><%= player_name.call(c[:player_id]) %></td>
<td><span title="<%= "#{'%.2f' % c[:points]}" %>"><%= "#{'%.0f' % c[:points]}" %></span></td>
</tr>
<% end %>
</table>
</div>

<div class="col-md-4">
<table class="table table-super-condensed table-borderless">
<% entry[:after].each do |c| %>
<% if highlight_map.key?(c[:player_id]) %>
<% if highlight_map[c[:player_id]] == :up %>
<tr class="classification-up">
<% elsif highlight_map[c[:player_id]] == :down %>
<tr class="classification-down">
<% elsif highlight_map[c[:player_id]] == :equal %>
<tr class="active">
<% end %>
<% else %>
<tr>
<% end %>
<td><%= player_name.call(c[:player_id]) %></td>
<td><span title="<%= "#{'%.2f' % c[:points]}" %>"><%= "#{'%.0f' % c[:points]}" %></span></td>
</tr>
<% end %>
</table>
</div>

</div>

<% end %>

</div>
